<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FernieX | –ê–≤—Ç–æ-–Ω–æ–º–µ—Ä–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #080810;
            --card: #0f0f1a;
            --card2: #161625;
            --border: rgba(255,255,255,0.07);
            --primary: #e63946;
            --primary-glow: rgba(230,57,70,0.4);
            --accent: #f4a261;
            --success: #2ec4b6;
            --success-glow: rgba(46,196,182,0.5);
            --text: #f0f0f0;
            --muted: #8888aa;
            --plate-bg: #fafafa;
            --plate-text: #111;
            --r: 16px;
            --slot-w: 52px;
            --slot-h: 66px;
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html, body { height:100%; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Rajdhani', sans-serif;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-image:
                radial-gradient(ellipse at 20% 0%, rgba(230,57,70,0.12) 0%, transparent 55%),
                radial-gradient(ellipse at 80% 100%, rgba(244,162,97,0.08) 0%, transparent 50%);
        }

        /* NOISE OVERLAY */
        body::before {
            content:'';
            position:fixed; inset:0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events:none; z-index:0;
        }

        .main-container {
            width:100%; max-width:500px; height:100%;
            position:relative; padding:20px;
            display:flex; flex-direction:column;
            margin:0 auto; flex:1; overflow:hidden; z-index:1;
        }

        /* HEADER */
        header {
            position:relative; top:auto; left:auto; width:100%;
            text-align:center; z-index:10; padding:16px 0 8px;
            flex-shrink:0;
            animation: float 4s ease-in-out infinite;
        }
        .logo {
            font-family:'Bebas Neue', sans-serif;
            font-size:1.6rem; letter-spacing:3px;
            color:var(--text);
        }
        .logo .accent { color:var(--primary); }
        .logo-sub {
            font-size:0.65rem; letter-spacing:4px; color:var(--muted);
            text-transform:uppercase; margin-top:-4px;
        }

        /* STEPS */
        .step {
            position:absolute; top:0; left:0; width:100%; height:100%;
            display:flex; flex-direction:column;
            justify-content:center; align-items:center;
            opacity:0; visibility:hidden;
            transform:translateY(24px);
            transition:opacity 0.4s ease, transform 0.4s ease, visibility 0.4s;
            padding:20px;
        }
        /* Generator step: header inside, scrollable */
        #step-generator {
            justify-content:flex-start;
            padding:0 20px 20px;
            overflow-y:auto;
            scrollbar-width:none;
        }
        #step-generator::-webkit-scrollbar { display:none; }
        #step-generator header {
            position:relative; width:100%;
            margin-bottom:8px;
        }
        #step-generator .content-box {
            width:100%;
        }
        .step.active {
            opacity:1; visibility:visible; transform:translateY(0);
        }
        .content-box { width:100%; text-align:center; }
        .content-box.wide {
            max-height:85vh; overflow-y:auto; padding-top:90px;
            scrollbar-width:none;
        }
        .content-box.wide::-webkit-scrollbar { display:none; }

        /* TYPOGRAPHY */
        h1 {
            font-family:'Bebas Neue', sans-serif;
            font-size:3rem; line-height:1;
            letter-spacing:2px; margin-bottom:12px;
            background: linear-gradient(135deg, #fff 0%, var(--primary) 100%);
            -webkit-background-clip:text; -webkit-text-fill-color:transparent;
        }
        h2 {
            font-family:'Bebas Neue', sans-serif;
            font-size:1.8rem; letter-spacing:2px; margin-bottom:20px;
        }
        .subtitle {
            color:var(--muted); margin-bottom:40px;
            font-size:1rem; line-height:1.5; font-weight:400;
        }

        /* BUTTONS */
        button { cursor:pointer; border:none; outline:none; font-family:'Rajdhani',sans-serif; font-weight:700; position:relative; overflow:hidden; transition:all 0.2s ease; }

        .btn-primary {
            background: var(--primary);
            color:#fff; padding:14px 32px;
            border-radius:50px; width:100%;
            box-shadow: 0 6px 24px var(--primary-glow);
            font-size:1rem; letter-spacing:1px; text-transform:uppercase;
        }
        .btn-primary:hover { transform:translateY(-3px); box-shadow:0 12px 32px var(--primary-glow); filter:brightness(1.1); }
        .btn-primary:active { transform:translateY(-1px); }
        .btn-primary:disabled {
            background:#222; color:#444; box-shadow:none;
            cursor:not-allowed; transform:none; filter:none;
        }

        .btn-secondary {
            background:transparent; border:2px solid var(--primary);
            color:var(--primary); padding:10px 20px;
            border-radius:12px; font-size:0.85rem;
            letter-spacing:1px; text-transform:uppercase;
            min-width:120px;
        }
        .btn-secondary:hover:not(:disabled) {
            background:rgba(230,57,70,0.12);
            box-shadow:0 0 16px var(--primary-glow);
            transform:scale(1.03);
        }
        .btn-secondary:disabled { border-color:#333; color:#333; cursor:not-allowed; }

        .btn-text {
            background:transparent; color:var(--muted);
            padding:10px 20px; font-size:0.95rem; letter-spacing:0.5px;
        }
        .btn-text:hover { color:#fff; }

        /* PLATE PREVIEW - Real Russian style */
        .plate-wrap {
            display:flex; justify-content:center;
            margin-bottom:24px;
        }
        .plate-preview {
            display:inline-flex; align-items:stretch;
            background: #fff;
            border-radius:8px;
            border:3px solid #111;
            box-shadow: 0 6px 28px rgba(0,0,0,0.7), inset 0 0 0 2px #fff;
            overflow:hidden;
            min-height:64px;
        }
        .plate-main {
            display:flex; align-items:center;
            padding:6px 10px 6px 12px; gap:2px;
        }
        .plate-text {
            font-family:'JetBrains Mono', monospace;
            font-size:2.2rem; font-weight:700;
            color:#111; line-height:1;
            min-width:1ch; text-align:center;
        }
        .plate-text.spinning-char { color:#aaa; }
        .plate-spacer { width:6px; }
        /* Right region block */
        .plate-region-block {
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            background:#fff;
            border-left:3px solid #111;
            padding:4px 10px;
            min-width:58px;
        }
        .plate-region-num {
            font-family:'JetBrains Mono', monospace;
            font-size:1.6rem; font-weight:700; color:#111;
            line-height:1; letter-spacing:1px;
        }
        .plate-rus {
            font-family:'Rajdhani', sans-serif;
            font-size:0.6rem; font-weight:700; color:#111;
            letter-spacing:2px; margin-top:1px;
        }
        .plate-flag {
            display:flex; flex-direction:column; overflow:hidden;
            border-radius:1px; margin-top:2px;
            width:22px; height:14px;
        }
        .plate-flag span {
            flex:1; display:block;
        }
        .flag-w { background:#fff; border:0.5px solid #ddd; }
        .flag-b { background:#1C3F7C; }
        .flag-r { background:#D52B1E; }

        /* SLOT GROUPS */
        .slot-groups {
            display:flex; align-items:center; justify-content:center;
            gap:8px; margin-bottom:24px;
            flex-wrap:nowrap; /* –≤—Å–µ–≥–¥–∞ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É */
            overflow-x:auto;
            scrollbar-width:none;
        }
        .slot-groups::-webkit-scrollbar { display:none; }
        .slot-group {
            display:flex; flex-direction:column; align-items:center; gap:6px;
            flex-shrink:0;
        }
        .slot-group-label {
            font-size:0.6rem; letter-spacing:2px; color:var(--muted);
            text-transform:uppercase; white-space:nowrap;
        }
        .slots-row {
            display:flex; gap:4px;
            background:var(--card);
            padding:10px 8px;
            border-radius:12px;
            border:1px solid var(--border);
            box-shadow:inset 0 0 20px rgba(0,0,0,0.6);
        }
        .slot-sep {
            display:flex; align-items:center;
            color:var(--muted); font-size:1.2rem; font-family:'JetBrains Mono',monospace;
            padding-top:0; flex-shrink:0;
            align-self:center;
        }

        .slot-digit {
            width:42px; height:56px;
            background:#050508;
            color:var(--primary);
            font-size:1.6rem; font-weight:700;
            font-family:'JetBrains Mono', monospace;
            display:flex; justify-content:center; align-items:center;
            border-radius:8px;
            border:1px solid #222;
            box-shadow:inset 0 0 12px rgba(0,0,0,0.9);
            transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);
        }
        .slot-digit.fixed {
            background:var(--success);
            color:#fff;
            border-color:#5efff5;
            box-shadow:0 0 18px var(--success-glow);
            transform:scale(1.08);
            z-index:2;
        }

        /* SPIN BUTTONS ROW */
        .spin-buttons {
            display:flex; gap:10px; justify-content:center;
            margin-bottom:24px; flex-wrap:wrap;
        }

        /* NAV */
        .navigation-buttons {
            display:flex; gap:15px; justify-content:space-between;
            align-items:center; margin-top:10px; width:100%;
        }

        /* FINAL */
        .success-icon {
            font-size:3.5rem; color:var(--success);
            margin-bottom:16px;
            text-shadow:0 0 30px var(--success-glow);
            animation: pop 0.5s cubic-bezier(0.34,1.56,0.64,1);
        }
        @keyframes pop { from { transform:scale(0.4); opacity:0; } to { transform:scale(1); opacity:1; } }

        .summary-card {
            background:linear-gradient(145deg,var(--card),var(--card2));
            padding:24px; border-radius:var(--r);
            margin:24px 0; text-align:left;
            border:1px solid var(--border);
            box-shadow:0 10px 30px rgba(0,0,0,0.4);
        }
        .summary-row {
            display:flex; justify-content:space-between; align-items:center;
            margin-bottom:14px; color:var(--muted);
            font-size:0.95rem; padding-bottom:12px;
            border-bottom:1px dashed rgba(255,255,255,0.08);
        }
        .summary-row:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
        .summary-row .white {
            color:#fff; font-weight:700; font-size:1.1rem;
            font-family:'JetBrains Mono',monospace;
        }

        /* PLATE IN SUMMARY */
        .plate-small {
            display:inline-flex; align-items:center;
            background:#f5f5f5; border-radius:6px;
            padding:4px 10px; border:2px solid #bbb;
            font-family:'JetBrains Mono',monospace;
            font-size:1rem; font-weight:700; color:#111;
            letter-spacing:2px;
        }

        /* FOOTER */
        footer.footer {
            background:rgba(0,0,0,0.35);
            border-top:1px solid var(--border);
            padding:12px; text-align:center;
            font-size:0.65rem; color:var(--muted);
            z-index:1;
        }
        footer.footer p { margin:3px 0; line-height:1.3; }
        footer.footer p:first-child { color:var(--primary); font-weight:700; letter-spacing:1px; }

        /* ANIMATIONS */
        @keyframes fadeInUp { from {opacity:0;transform:translateY(30px) scale(0.96);} to {opacity:1;transform:translateY(0) scale(1);} }
        .step.active { animation: fadeInUp 0.5s cubic-bezier(0.2,0.8,0.2,1) forwards; }

        @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-4px);} }
        header { animation: float 4s ease-in-out infinite; }

        /* MOBILE */
        @media (max-width:480px) {
            h1 { font-size:2.4rem; }
            h2 { font-size:1.4rem; margin-bottom:12px; }
            .slot-digit { width:36px; height:50px; font-size:1.35rem; }
            .slots-row { padding:8px 6px; gap:3px; }
            .slot-groups { gap:5px; }
            .plate-text { font-size:1.5rem; }
            .plate-region-num { font-size:1.2rem; }
            .slot-group-label { font-size:0.55rem; letter-spacing:1px; }
            .spin-buttons { gap:6px; }
            .btn-secondary { min-width:90px; padding:8px 12px; font-size:0.8rem; }
        }
    </style>
</head>
<body>
    <div class="main-container">

        <!-- WELCOME -->
        <section id="step-welcome" class="step active">
            <div class="content-box">
                <div style="margin-bottom:16px;">
                    <div class="logo">Fernie<span class="accent">X</span></div>
                    <div class="logo-sub">–ê–≤—Ç–æ-–Ω–æ–º–µ—Ä–∞</div>
                </div>
                <h1>–¢–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π<br>–∞–≤—Ç–æ-–Ω–æ–º–µ—Ä</h1>
                <p class="subtitle">–ö—Ä—É—Ç–∏ —Å–ª–æ—Ç—ã –∏ –ø–æ–ª—É—á–∏ –∫—Ä–∞—Å–∏–≤—ã–π —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –Ω–æ–º–µ—Ä–Ω–æ–π –∑–Ω–∞–∫ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥</p>
                <button class="btn-primary" onclick="goToStep('step-generator')">–ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä</button>
            </div>
        </section>

        <!-- GENERATOR -->
        <section id="step-generator" class="step">
            <header>
                <div class="logo">Fernie<span class="accent">X</span></div>
                <div class="logo-sub">–ê–≤—Ç–æ-–Ω–æ–º–µ—Ä–∞</div>
            </header>
            <div class="content-box">
                <h2>–ö—Ä—É—Ç–∏ –Ω–æ–º–µ—Ä</h2>

                <!-- Live plate preview -->
                <div class="plate-wrap">
                    <div class="plate-preview">
                        <div class="plate-main">
                            <span class="plate-text" id="prev-l1">–ê</span>
                            <span class="plate-text" id="prev-n1">0</span>
                            <span class="plate-text" id="prev-n2">0</span>
                            <span class="plate-text" id="prev-n3">0</span>
                            <div class="plate-spacer"></div>
                            <span class="plate-text" id="prev-l2">–ê</span>
                            <span class="plate-text" id="prev-l3">–ê</span>
                        </div>
                        <div class="plate-region-block">
                            <span class="plate-region-num" id="prev-reg">77</span>
                            <span class="plate-rus">RUS</span>
                            <div class="plate-flag">
                                <span class="flag-w"></span>
                                <span class="flag-b"></span>
                                <span class="flag-r"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SLOTS -->
                <div class="slot-groups">
                    <!-- Letters group 1: letter 1 -->
                    <div class="slot-group">
                        <div class="slot-group-label">–ë—É–∫–≤–∞</div>
                        <div class="slots-row">
                            <div class="slot-digit letter-slot" id="l1">–ê</div>
                        </div>
                    </div>

                    <!-- Numbers -->
                    <div class="slot-group">
                        <div class="slot-group-label">–¶–∏—Ñ—Ä—ã</div>
                        <div class="slots-row">
                            <div class="slot-digit num-slot" id="n1">0</div>
                            <div class="slot-digit num-slot" id="n2">0</div>
                            <div class="slot-digit num-slot" id="n3">0</div>
                        </div>
                    </div>

                    <!-- Letters 2+3 -->
                    <div class="slot-group">
                        <div class="slot-group-label">–ë—É–∫–≤—ã</div>
                        <div class="slots-row">
                            <div class="slot-digit letter-slot" id="l2">–ê</div>
                            <div class="slot-digit letter-slot" id="l3">–ê</div>
                        </div>
                    </div>

                    <div class="slot-sep">|</div>

                    <!-- Region -->
                    <div class="slot-group">
                        <div class="slot-group-label">–†–µ–≥–∏–æ–Ω</div>
                        <div class="slots-row">
                            <div class="slot-digit num-slot" id="r1" style="width:44px">7</div>
                            <div class="slot-digit num-slot" id="r2" style="width:44px">7</div>
                        </div>
                    </div>
                </div>

                <!-- Spin buttons -->
                <div class="spin-buttons">
                    <button class="btn-secondary" id="btn-letters" onclick="spinGroup('letters')">–ë—É–∫–≤—ã</button>
                    <button class="btn-secondary" id="btn-numbers" onclick="spinGroup('numbers')">–¶–∏—Ñ—Ä—ã</button>
                    <button class="btn-secondary" id="btn-region" onclick="spinGroup('region')">–†–µ–≥–∏–æ–Ω</button>
                </div>
                <div style="margin-bottom:20px;">
                    <button class="btn-primary" id="btn-full" onclick="spinAll()" style="font-size:0.9rem; padding:12px 28px;">üé≤ –ü–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä</button>
                </div>

                <div class="navigation-buttons">
                    <button class="btn-text" onclick="resetAndBack()">–ù–∞–∑–∞–¥</button>
                    <button class="btn-primary" id="btn-continue" onclick="goToStep('step-final')" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                </div>
            </div>
        </section>

        <!-- FINAL -->
        <section id="step-final" class="step">
            <div class="content-box">
                <div class="success-icon">‚úì</div>
                <h2>–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ!</h2>
                <p class="subtitle" style="margin-bottom:0">–ü—Ä–æ–≤–µ—Ä—å –Ω–æ–º–µ—Ä –∏ –ø–æ–ª—É—á–∏ –µ–≥–æ –≤ –±–æ—Ç–µ.</p>

                <div class="summary-card">
                    <div class="summary-row">
                        <span>–ù–æ–º–µ—Ä–Ω–æ–π –∑–Ω–∞–∫:</span>
                        <span id="final-plate" class="white"></span>
                    </div>
                    <div class="summary-row">
                        <span>–ë—É–∫–≤—ã:</span>
                        <span id="final-letters" class="white"></span>
                    </div>
                    <div class="summary-row">
                        <span>–¶–∏—Ñ—Ä—ã:</span>
                        <span id="final-numbers" class="white"></span>
                    </div>
                    <div class="summary-row">
                        <span>–†–µ–≥–∏–æ–Ω:</span>
                        <span id="final-region" class="white"></span>
                    </div>
                </div>

                <button class="btn-primary" id="btn-telegram">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å</button>
                <button class="btn-text" style="margin-top:14px" onclick="goToStep('step-generator')">–ù–∞–∑–∞–¥</button>
            </div>
        </section>
    </div>

    <footer class="footer">
        <p>¬© 2026. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã —Å–µ—Ä–≤–∏—Å–æ–º FernieX</p>
        <p>–ù–æ–º–µ—Ä–∞ —è–≤–ª—è—é—Ç—Å—è –∏–≥—Ä–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∏ –Ω–µ –∏–º–µ—é—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ —Ä–µ–∞–ª—å–Ω—ã–º –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º –Ω–æ–º–µ—Ä–∞–º</p>
    </footer>

    <script>
        // --- DATA ---
        const LETTERS = ['–ê','–í','–ï','–ö','–ú','–ù','–û','–†','–°','–¢','–£','–•'];
        const REGIONS = [
            '01','02','03','04','05','06','07','08','09','10',
            '11','12','13','14','15','16','17','18','19','20',
            '21','22','23','24','25','26','27','28','29','30',
            '31','32','33','34','35','36','37','38','39','40',
            '41','42','43','44','45','46','47','48','49','50',
            '51','52','53','54','55','56','57','58','59','60',
            '61','62','63','64','65','66','67','68','69','70',
            '71','72','73','74','75','76','77','78','79','80',
            '81','82','83','86','87','89','90','91','92','93',
            '94','95','96','97','98','99','102','116','123','161','163','174','177','178','190','197','199'
        ];

        // --- STATE ---
        let plate = { l1:'–ê', n1:'0', n2:'0', n3:'0', l2:'–ê', l3:'–ê', region:'77' };
        let spunGroups = { letters: false, numbers: false, region: false };
        let activeTimers = [];
        let activeIntervals = [];
        let spinning = false;

        // --- UTILS ---
        function randLetter() { return LETTERS[Math.floor(Math.random()*LETTERS.length)]; }
        function randDigit() { return String(Math.floor(Math.random()*10)); }
        function randRegion() { return REGIONS[Math.floor(Math.random()*REGIONS.length)]; }

        function checkAllSpun() {
            if (spunGroups.letters && spunGroups.numbers && spunGroups.region && !spinning) {
                document.getElementById('btn-continue').disabled = false;
            }
        }

        function setSlotFixed(id, value) {
            const el = document.getElementById(id);
            el.textContent = value;
            el.classList.add('fixed');
        }

        function clearSlotFixed(id) {
            const el = document.getElementById(id);
            el.classList.remove('fixed');
        }

        // --- SPIN GROUP ---
        function spinGroup(group) {
            if (spinning) return;
            spinning = true;

            // Disable all spin buttons
            ['letters','numbers','region'].forEach(g => {
                document.getElementById('btn-'+g).disabled = true;
            });
            document.getElementById('btn-continue').disabled = true;

            let slots, finalValues, genFn;
            let previewIds = [];

            if (group === 'letters') {
                slots = ['l1','l2','l3'];
                previewIds = ['prev-l1','prev-l2','prev-l3'];
                finalValues = [randLetter(), randLetter(), randLetter()];
                genFn = randLetter;
                ['l1','l2','l3'].forEach(s => {
                    clearSlotFixed(s);
                    document.getElementById(s).textContent = '-';
                });
                // Show dashes in preview
                ['prev-l1','prev-l2','prev-l3'].forEach(id => {
                    const el = document.getElementById(id);
                    el.textContent = '-';
                    el.classList.add('spinning-char');
                });
            } else if (group === 'numbers') {
                slots = ['n1','n2','n3'];
                previewIds = ['prev-n1','prev-n2','prev-n3'];
                finalValues = [randDigit(), randDigit(), randDigit()];
                genFn = randDigit;
                ['n1','n2','n3'].forEach(s => {
                    clearSlotFixed(s);
                    document.getElementById(s).textContent = '-';
                });
                ['prev-n1','prev-n2','prev-n3'].forEach(id => {
                    const el = document.getElementById(id);
                    el.textContent = '-';
                    el.classList.add('spinning-char');
                });
            } else {
                const reg = randRegion();
                const r1v = reg[0] || '7';
                const r2v = reg.length >= 2 ? reg.slice(1) : '7';
                slots = ['r1','r2'];
                finalValues = [r1v, r2v];
                genFn = randDigit;
                ['r1','r2'].forEach(s => {
                    clearSlotFixed(s);
                    document.getElementById(s).textContent = '-';
                });
                // Show dashes in region preview
                const prevReg = document.getElementById('prev-reg');
                prevReg.textContent = '--';
                prevReg.classList.add('spinning-char');
                plate.region = reg;
            }

            // Spin intervals
            const intervals = slots.map(id => {
                const iv = setInterval(() => {
                    document.getElementById(id).textContent = genFn();
                }, 60);
                activeIntervals.push(iv);
                return iv;
            });

            // Settle one by one
            let settled = 0;
            slots.forEach((id, i) => {
                const t = setTimeout(() => {
                    clearInterval(intervals[i]);
                    document.getElementById(id).textContent = finalValues[i];
                    setSlotFixed(id, finalValues[i]);

                    // Update plate state & preview
                    if (group === 'letters') {
                        plate[id] = finalValues[i];
                        const prevId = previewIds[i];
                        const el = document.getElementById(prevId);
                        el.textContent = finalValues[i];
                        el.classList.remove('spinning-char');
                    } else if (group === 'numbers') {
                        plate[id] = finalValues[i];
                        const prevId = previewIds[i];
                        const el = document.getElementById(prevId);
                        el.textContent = finalValues[i];
                        el.classList.remove('spinning-char');
                    } else {
                        // region: update preview when last slot settles
                        if (i === slots.length - 1) {
                            const prevReg = document.getElementById('prev-reg');
                            prevReg.textContent = plate.region;
                            prevReg.classList.remove('spinning-char');
                        }
                    }

                    settled++;
                    if (settled === slots.length) {
                        spunGroups[group] = true;
                        spinning = false;
                        ['letters','numbers','region'].forEach(g => {
                            document.getElementById('btn-'+g).disabled = false;
                        });
                        checkAllSpun();
                    }
                }, 500 + i * 350);
                activeTimers.push(t);
            });
        }

        // --- SPIN ALL (–ü–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä) ---
        function spinAll() {
            if (spinning) return;
            spinning = true;
            ['letters','numbers','region'].forEach(g => {
                document.getElementById('btn-'+g).disabled = true;
            });
            document.getElementById('btn-full').disabled = true;
            document.getElementById('btn-continue').disabled = true;

            const groups = ['letters', 'numbers', 'region'];
            let completedGroups = 0;

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞—Ä–∞–Ω–µ–µ
            const finalLetters = [randLetter(), randLetter(), randLetter()];
            const finalNumbers = [randDigit(), randDigit(), randDigit()];
            const reg = randRegion();
            const r1v = reg[0] || '7';
            const r2v = reg.length >= 2 ? reg.slice(1) : '7';
            const finalRegion = [r1v, r2v];

            plate.region = reg;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Å–ª–æ—Ç—ã –≤ –¥–µ—Ñ–∏—Å —Å—Ä–∞–∑—É
            ['l1','l2','l3'].forEach(s => { clearSlotFixed(s); document.getElementById(s).textContent = '-'; });
            ['n1','n2','n3'].forEach(s => { clearSlotFixed(s); document.getElementById(s).textContent = '-'; });
            ['r1','r2'].forEach(s => { clearSlotFixed(s); document.getElementById(s).textContent = '-'; });
            ['prev-l1','prev-l2','prev-l3','prev-n1','prev-n2','prev-n3'].forEach(id => {
                const el = document.getElementById(id);
                el.textContent = '-'; el.classList.add('spinning-char');
            });
            document.getElementById('prev-reg').textContent = '--';
            document.getElementById('prev-reg').classList.add('spinning-char');

            // –ö—Ä—É—Ç–∏–º –≤—Å–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
            const allSlots = [
                { id:'l1', final: finalLetters[0], genFn: randLetter, prevId:'prev-l1', group:'letters' },
                { id:'n1', final: finalNumbers[0], genFn: randDigit,  prevId:'prev-n1', group:'numbers' },
                { id:'n2', final: finalNumbers[1], genFn: randDigit,  prevId:'prev-n2', group:'numbers' },
                { id:'n3', final: finalNumbers[2], genFn: randDigit,  prevId:'prev-n3', group:'numbers' },
                { id:'l2', final: finalLetters[1], genFn: randLetter, prevId:'prev-l2', group:'letters' },
                { id:'l3', final: finalLetters[2], genFn: randLetter, prevId:'prev-l3', group:'letters' },
                { id:'r1', final: finalRegion[0],  genFn: randDigit,  prevId: null,     group:'region' },
                { id:'r2', final: finalRegion[1],  genFn: randDigit,  prevId: null,     group:'region' },
            ];

            const intervals = allSlots.map(slot => {
                const iv = setInterval(() => {
                    document.getElementById(slot.id).textContent = slot.genFn();
                }, 60);
                activeIntervals.push(iv);
                return iv;
            });

            let settled = 0;
            allSlots.forEach((slot, i) => {
                const t = setTimeout(() => {
                    clearInterval(intervals[i]);
                    document.getElementById(slot.id).textContent = slot.final;
                    setSlotFixed(slot.id, slot.final);

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ plate
                    if (slot.group === 'letters') plate[slot.id] = slot.final;
                    else if (slot.group === 'numbers') plate[slot.id] = slot.final;

                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
                    if (slot.prevId) {
                        const el = document.getElementById(slot.prevId);
                        el.textContent = slot.final;
                        el.classList.remove('spinning-char');
                    }

                    settled++;

                    // –†–µ–≥–∏–æ–Ω –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–≥–¥–∞ r2 –≥–æ—Ç–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑ —Ä–µ–≥–∏–æ–Ω–∞)
                    if (slot.id === 'r2') {
                        const prevReg = document.getElementById('prev-reg');
                        prevReg.textContent = plate.region;
                        prevReg.classList.remove('spinning-char');
                    }

                    if (settled === allSlots.length) {
                        spunGroups = { letters: true, numbers: true, region: true };
                        spinning = false;
                        ['letters','numbers','region'].forEach(g => {
                            document.getElementById('btn-'+g).disabled = false;
                        });
                        document.getElementById('btn-full').disabled = false;
                        document.getElementById('btn-continue').disabled = false;
                    }
                }, 400 + i * 200);
                activeTimers.push(t);
            });
        }

        // --- NAV ---
        function goToStep(stepId) {
            if (stepId === 'step-welcome') {
                resetAll();
            }
            if (stepId !== 'step-generator') {
                activeTimers.forEach(t => clearTimeout(t));
                activeTimers = [];
                activeIntervals.forEach(iv => clearInterval(iv));
                activeIntervals = [];
            }
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(stepId).classList.add('active');

            if (stepId === 'step-final') {
                const plateStr = `${plate.l1} ${plate.n1}${plate.n2}${plate.n3} ${plate.l2}${plate.l3} | ${plate.region}`;
                document.getElementById('final-plate').textContent = plateStr;
                document.getElementById('final-letters').textContent = `${plate.l1} ${plate.l2}${plate.l3}`;
                document.getElementById('final-numbers').textContent = `${plate.n1}${plate.n2}${plate.n3}`;
                document.getElementById('final-region').textContent = plate.region;
            }
        }

        function resetAll() {
            activeTimers.forEach(t => clearTimeout(t));
            activeTimers = [];
            activeIntervals.forEach(iv => clearInterval(iv));
            activeIntervals = [];
            spinning = false;

            plate = { l1:'–ê', n1:'0', n2:'0', n3:'0', l2:'–ê', l3:'–ê', region:'77' };
            spunGroups = { letters:false, numbers:false, region:false };

            ['l1','l2','l3','n1','n2','n3'].forEach(id => {
                const el = document.getElementById(id);
                el.classList.remove('fixed');
                if (['l1','l2','l3'].includes(id)) el.textContent = '–ê';
                else el.textContent = '0';
            });
            document.getElementById('r1').textContent = '7';
            document.getElementById('r2').textContent = '7';
            document.getElementById('r1').classList.remove('fixed');
            document.getElementById('r2').classList.remove('fixed');

            // Reset preview
            const prevIds = ['prev-l1','prev-n1','prev-n2','prev-n3','prev-l2','prev-l3'];
            const prevVals = ['–ê','0','0','0','–ê','–ê'];
            prevIds.forEach((id,i) => {
                const el = document.getElementById(id);
                el.textContent = prevVals[i];
                el.classList.remove('spinning-char');
            });
            const prevReg = document.getElementById('prev-reg');
            prevReg.textContent = '77';
            prevReg.classList.remove('spinning-char');

            document.getElementById('btn-continue').disabled = true;
            ['letters','numbers','region'].forEach(g => {
                document.getElementById('btn-'+g).disabled = false;
            });
        }

        function resetAndBack() {
            resetAll();
            goToStep('step-welcome');
        }

        // --- TELEGRAM ---
        const CYR_TO_LAT = {
            '–ê':'A','–í':'B','–ï':'E','–ö':'K','–ú':'M',
            '–ù':'H','–û':'O','–†':'P','–°':'C','–¢':'T','–£':'Y','–•':'X'
        };

        document.getElementById('btn-telegram').addEventListener('click', () => {
            const plateStr = `${plate.l1}${plate.n1}${plate.n2}${plate.n3}${plate.l2}${plate.l3}${plate.region}`;
            const latin = plateStr.split('').map(c => CYR_TO_LAT[c] || c).join('');
            const botLink = `https://t.me/FernieXBot?start=carnumber_${latin}`;
            window.open(botLink, '_blank');
        });

    </script>
</body>
</html>
